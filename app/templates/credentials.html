{% extends "base.html" %}
{% block title%}Manage Credentials{% endblock %}
{% block content %}

<div class="span9"> <!-- Because of the row-fluid in base.html -->

<div class="span9">
<div class="well well-large">

<form id="credentials" action="/credentials" method="post">
    
    <h2><a data-toggle="modal" class="show" href="#help_modal1" style="text-decoration: none;">AWS Credentials <i class="icon-question-sign"></i> </a></h2>
        
    {% set help_modal_id = "help_modal1" %}
    {% set help_modal_title = "AWS Credentials" %}
    {% set help_modal_message = "In order to use cloud computing resources, you need to enter your personal credentials for Amazon Web Services (AWS). You can obtain the credentials from the AWS control panel after logging in to you AWS account." %}
    {% include "help_modal.html" %}
    {{help_modal|safe}}
</h2>
    
<label> Access Key </label>
{% if active_vms == False %}
<input class="span3" type="text" name="ec2_access_key" value="{{EC2_ACCESS_KEY}}">
<label> Secret Key </label>
<input class="span3" type="text" name="ec2_secret_key" value="{{EC2_SECRET_KEY}}">
<br><br>
<button type="submit" class="btn btn-primary btn-large" name="save" style="float:bottom;"><i class="icon-save"></i> Save credentials</button>
{% else %}
<input class="span3" type="text" name="ec2_access_key" value="{{EC2_ACCESS_KEY}}" disabled>
<label> Secret Key </label>
<input class="span3" type="text" name="ec2_secret_key" value="{{EC2_SECRET_KEY}}" disabled>
<br><br>
<button type="submit" class="btn btn-primary btn-large" name="save" style="float:bottom;" disabled><i class="icon-save"></i> Locked, nodes running</button>
{% endif %}
<!-- Display status messages -->
{% if credentials_msg %}
</br></br>
{% if status == False %}
<span style="color: red">{{credentials_msg}}</span>
{% else %}
<span style="color: green">{{credentials_msg}}</span>
{% endif %}
{% endif %}
</form>
</div>
</div>

<div class="span9">
<div class="well well-large">
<form id="start_vms" action="/credentials" method="post">
    
<h2><a data-toggle="modal" href="#help_modal2" style="text-decoration: none">Compute nodes <i class="icon-question-sign"></i></a>
    {% set help_modal_id = "help_modal2" %}
    {% set help_modal_title = "Compute nodes" %}
    {% set help_modal_message = "Computes nodes are computers in the Cloud that come preconfigured to run the simulations you
    configure in the app. You can launch one or more such compute nodes by filling in the number of nodes in the box and clicking the Launch button. In this version of StochSS, we use t1.micro instances in Amazon EC2 so that you can use your free usage tier with AWS to evaluate the app, consult your AWS account for details."   %}
    {% include "help_modal.html" %}
    {{help_modal|safe}}
</h2>
<br>
<h2>Launch new compute nodes</h2>
<label> Choose number of nodes and types </label>
<fieldset>
    <legend> Micro: </legend>
    <table>
        <tr>
            <td>t1.micro</td>
            <td><input class="span3" type="number" name="num_t1.micro" placeholder="[1-20]" /></td>
        </tr>
        <tr>
            <td>m1.small</td>
            <td><input class="span3" type="number" name="num_m1.small" placeholder="[1-20]" /></td>
        </tr>
    </table>
</fieldset>

<fieldset>
    <legend> M3: </legend>
    <table>
        <tr>
            <td>m3.medium</td>
            <td><input class="span3" type="number" name="num_m3.medium" placeholder="[1-20]" /></td>
        </tr>
        <tr>
            <td>m3.large</td>
            <td><input class="span3" type="number" name="num_m3.large" placeholder="[1-20]" /></td>
        </tr>
    </table>
</fieldset>

<fieldset>
    <legend> C3: </legend>
    <table>
        <tr>
            <td>c3.large</td>
            <td><input class="span3" type="number" name="num_c3.large" placeholder="[1-20]" /></td>
        </tr>
        <tr>
            <td>c3.xlarge</td>
            <td><input class="span3" type="number" name="num_c3.xlarge" placeholder="[1-20]" /></td>
        </tr>
    </table>
</fieldset>

<!--
<div id="vm_number_type_block">
<span>
    <input class="span3" type="number" name="vm_number0" placeholder="[1-20]" />
    <select name="vm_type0">
        <option value="t1.micro">t1.micro</option>
        <option value="m1.small">m1.small</option>
        <option value="m1.medium">m1.medium</option>
        <option value="m3.medium">m3.medium</option>
        <option value="c3.large" selected>c3.large</option>
    </select>
</span>
</div>
-->

{% if starting_vms %}
<br><button id="start_btn" class="btn btn-primary btn-large" name="start"  disabled><i class="icon-cloud"></i> Launching Nodes... </button>
   <!-- <script>setTimeout(function(){location.reload();},10000); </script>-->
{% elif valid_credentials and (not number_pending or not not number_creating or number_creating == 0 or number_pending == 0)%}
<br><button id="start_btn" class="btn btn-primary btn-large" name="start"><i class="icon-cloud"></i> Launch nodes </button>
{% else %}
<br><button id="start_btn" class="btn btn-primary btn-large" name="start" disabled><i class="icon-cloud"></i> Launch nodes </button>
{% endif %}



</form>

<!--
<button id="add_btn" name="add_btn" onclick="addMoreVms()" > + </button>
<button id="del_btn" name="del_btn" onclick="deleteVms()" > - </button>
-->


<!-- Display status messages -->
{% if msg %}
</br></br>
{% if status == 'False' %}
<span style="color: red">{{msg}}</span>
{% else %}
<span style="color: green">{{msg}}</span>
{% endif %}
{% endif %}

<hr>


<h3> Status of VMs: </h3>

<!-- Display the status of the VMs -->
{% if active_vms == False %}
&nbsp;&nbsp;<span style="color: green;font-size: 16px" class="create_msg"> There are no active compute nodes.  </span>
{% endif %}


{% if number_creating %}
&nbsp;&nbsp;<span style="color:red; font-size: 16px" class="create_msg"> Creaing: {{number_creating}}
</span>
{% endif %}
<br>
{% if number_pending %}
&nbsp;&nbsp;<span style="color:red; font-size: 16px" class="create_msg"> Pending: {{number_pending}}
</span>
{% endif %}
<br>
{% if number_running %}
&nbsp;&nbsp;<span style="color: green;font-size: 16px" class="create_msg"> Running: {{number_running}}
</span>
{% endif %}
<br>
{% if number_failed %}
&nbsp;&nbsp;<span style="color: green;font-size: 16px" class="create_msg"> Failed: {{number_failed}}
</span>
{% endif %}
    
<!-- Display error messages related to VMs -->
{% if vm_status_msg %}
</br></br>
{% if vm_status == False %}
<span style="color: red">{{vm_status_msg}}</span>
{% else %}
<span style="color: green">{{vm_status_msg}}</span>
{% endif %}
{% endif %}
    
    
<br>
<br>

<form id="refresh_vms" action="/credentials" method="post">
<button type = "submit" class="btn btn-primary btn-large" name="refresh"><i class="icon-refresh"></i> Refresh status</button>
{% if active_vms %}
<button type = "submit" class="btn btn-primary btn-large" name="stop" value="Stop all VMs"><i class="icon-ban-circle"></i> Stop all nodes </button>
{% else %}
<button type = "submit" class="btn btn-primary btn-large" name="stop" value="Stop all VMs" disabled><i class="icon-ban-circle"></i> Terminate all nodes </button>
{% endif %}
</form>
</div>
</div>
    
    </div>

{% endblock %}

{% block jscontent %}
<script language = "javascript">
function addMoreVms(){
    
    var block = document.getElementById("vm_number_type_block");
    var count = block.children.length;

    var span = document.createElement("span");
//    span.setAttribute("id", "vm_group"+count.toString());
    block.appendChild(span);
    
    var br = document.createElement("br");
    span.appendChild(br);

    var input = document.createElement("input");
    input.setAttribute("class", "span3");
    input.setAttribute("type", "number");
    input.setAttribute("name", "vm_number"+count.toString());
    input.setAttribute("placeholder", "[1-20]");
    span.appendChild(input);
    
    var select = document.createElement("select");
    select.setAttribute("name", "vm_type"+count.toString());
    span.appendChild(select);
    
    var option = document.createElement("option");
    option.text = "t1.micro";
    option.setAttribute("value", "t1.micro");
    option.setAttribute("selected", true);
    select.appendChild(option);
    
    option = document.createElement("option");
    option.text = "m1.small";
    option.setAttribute("value", "m1.small");
    select.appendChild(option);
    
    option = document.createElement("option");
    option.text = "m1.medium";
    option.setAttribute("value", "m1.medium");
    select.appendChild(option);
    
    option = document.createElement("option");
    option.text = "m3.medium";
    option.setAttribute("value", "m3.medium");
    select.appendChild(option);
    
    option = document.createElement("option");
    option.text = "c3.large";
    option.setAttribute("value", "c3.large");
    select.appendChild(option);
    
    var checkbox = document.createElement("input");
    checkbox.setAttribute("type", "checkbox");
//    checkbox.setAttribute("id", "vm_delete_check"+count.toString());
    span.appendChild(checkbox);

    alert("add span "+count);


}

function deleteVms(){
    var i;
    var block = document.getElementById("vm_number_type_block");
    for(i = 1; i < block.children.length; i++){
        var span =  block.children[i];
        if(span.children[3].checked){
            block.removeChild(span);
            i--;
        }
    }
}

</script>
{% endblock %}


